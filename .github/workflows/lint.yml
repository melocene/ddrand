name: lint

permissions:
  contents: read

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  clippy:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - name: Run sccache-cache
        uses: mozilla-actions/sccache-action@v0.0.9
        # Workaround for a bug where Windows runners were not using the cache
        # Ref: https://github.com/Mozilla-Actions/sccache-action/issues/177#issuecomment-2928104810
      - name: Tell sccache to use Actions cache
        run: Add-Content -Path $env:GITHUB_ENV -Value "SCCACHE_GHA_ENABLED=true"
      - run: cargo clippy -- -Dwarnings
        env:
          SCCACHE_GHA_ENABLED: "true"
          RUSTC_WRAPPER: sccache

  fmt:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - run: cargo fmt -- --check
