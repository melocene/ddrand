name: lint

permissions:
  contents: read

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  clippy:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - name: Run sccache-cache
        uses: mozilla-actions/sccache-action@7d986dd989559c6ecdb630a3fd2557667be217ad # v0.0.9
        # Workaround for a bug where Windows runners were not using the cache
        # Ref: https://github.com/Mozilla-Actions/sccache-action/issues/177#issuecomment-2928104810
      - name: Tell sccache to use Actions cache
        run: Add-Content -Path $env:GITHUB_ENV -Value "SCCACHE_GHA_ENABLED=true"
      - run: cargo clippy -- -Dwarnings
        env:
          SCCACHE_GHA_ENABLED: "true"
          RUSTC_WRAPPER: sccache

  fmt:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - run: cargo fmt -- --check
